(()=>{"use strict";var e={n:n=>{var t=n&&n.__esModule?()=>n.default:()=>n;return e.d(t,{a:t}),t},d:(n,t)=>{for(var a in t)e.o(t,a)&&!e.o(n,a)&&Object.defineProperty(n,a,{enumerable:!0,get:t[a]})},o:(e,n)=>Object.prototype.hasOwnProperty.call(e,n)};const n=window.React,t=window.wp.plugins,a=window.wp.editPost,i=window.wp.i18n,r=window.wp.element,l=window.wp.data,s=window.wp.components,o=window.wp.apiFetch;var d=e.n(o);const m=({revision:e,isFirst:t,isLast:a,onSetCurrent:r,disabled:l})=>{const{id:o,title:d,author:m,date:c,status:g,is_current:v,excerpt:w}=e,u=e=>{switch(e){case"current":return(0,i.__)("Current","dgwltd-revision-manager");case"pending":return(0,i.__)("Pending","dgwltd-revision-manager");case"past":return(0,i.__)("Past","dgwltd-revision-manager");default:return(0,i.__)("Unknown","dgwltd-revision-manager")}};return(0,n.createElement)("div",{className:`dgw-timeline-item dgw-timeline-item--${g} ${v?"dgw-timeline-item--current":""}`},(0,n.createElement)("div",{className:"dgw-timeline-marker"},(0,n.createElement)("span",{className:"dgw-timeline-icon",role:"img","aria-label":u(g)},(e=>{switch(e){case"current":return"●";case"pending":return"◒";default:return"○"}})(g))),(0,n.createElement)("div",{className:"dgw-timeline-content"},(0,n.createElement)("div",{className:"dgw-timeline-header"},(0,n.createElement)("h4",{className:"dgw-timeline-title"},d||(0,i.__)("(No title)","dgwltd-revision-manager")),(0,n.createElement)("span",{className:`dgw-timeline-status dgw-timeline-status--${g}`},u(g))),(0,n.createElement)("div",{className:"dgw-timeline-meta"},(0,n.createElement)("span",{className:"dgw-timeline-author"},(0,i.__)("By","dgwltd-revision-manager")," ",m),(0,n.createElement)("span",{className:"dgw-timeline-date"},new Date(c).toLocaleDateString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}))),w&&(0,n.createElement)("p",{className:"dgw-timeline-excerpt"},w),(0,n.createElement)("div",{className:"dgw-timeline-actions"},!v&&(0,n.createElement)(s.Button,{isSmall:!0,isSecondary:!0,onClick:r,disabled:l},(0,i.__)("Set as Current","dgwltd-revision-manager")),(0,n.createElement)(s.Button,{isSmall:!0,isTertiary:!0,href:`/wp-admin/revision.php?revision=${o}`,target:"_blank"},(0,i.__)("View","dgwltd-revision-manager")))))},c=({revisionData:e,onRevisionChange:t})=>{const[a,l]=(0,r.useState)(!1),[o,c]=(0,r.useState)(null),[g,v]=(0,r.useState)(null),{timeline:w,current_revision_id:u,total_revisions:_}=e,p=()=>{v(null)};return w&&0!==w.length?(0,n.createElement)("div",{className:"dgw-revision-timeline"},o&&(0,n.createElement)(s.Notice,{status:"error",isDismissible:!0,onRemove:()=>c(null)},o),(0,n.createElement)("div",{className:"dgw-timeline-header"},(0,n.createElement)("p",{className:"dgw-timeline-meta"},_," ",1===_?(0,i.__)("revision","dgwltd-revision-manager"):(0,i.__)("revisions","dgwltd-revision-manager"))),(0,n.createElement)("div",{className:"dgw-timeline-container"},(0,n.createElement)("div",{className:"dgw-timeline-line"}),w.map((e,t)=>(0,n.createElement)(m,{key:e.id,revision:e,isFirst:0===t,isLast:t===w.length-1,onSetCurrent:()=>(e=>{v(e)})(e),disabled:a}))),g&&(0,n.createElement)(s.Modal,{title:(0,i.__)("Set Revision as Current","dgwltd-revision-manager"),onRequestClose:p,className:"dgw-confirm-modal"},(0,n.createElement)("p",null,(0,i.__)("Are you sure you want to set this revision as the current version?","dgwltd-revision-manager")),(0,n.createElement)("div",{className:"dgw-modal-revision-preview"},(0,n.createElement)("h4",null,g.title||(0,i.__)("(No title)","dgwltd-revision-manager")),(0,n.createElement)("p",{className:"dgw-revision-meta"},(0,i.__)("By","dgwltd-revision-manager")," ",g.author," • ",new Date(g.date).toLocaleDateString()),g.excerpt&&(0,n.createElement)("p",{className:"dgw-revision-excerpt"},g.excerpt)),(0,n.createElement)("div",{className:"dgw-modal-actions"},(0,n.createElement)(s.Button,{isSecondary:!0,onClick:p,disabled:a},(0,i.__)("Cancel","dgwltd-revision-manager")),(0,n.createElement)(s.Button,{isPrimary:!0,onClick:()=>(async e=>{l(!0),c(null);try{(await d()({path:`/dgw-revision-manager/v1/revisions/${e}/set-current`,method:"POST"})).success?(t(),v(null)):c((0,i.__)("Failed to set revision as current.","dgwltd-revision-manager"))}catch(e){c((0,i.__)("Error setting revision as current.","dgwltd-revision-manager")),console.error("Error setting current revision:",e)}finally{l(!1)}})(g.id),disabled:a},a?(0,n.createElement)(s.Spinner,null):(0,i.__)("Set as Current","dgwltd-revision-manager"))))):(0,n.createElement)("div",{className:"dgw-timeline-empty"},(0,n.createElement)("p",null,(0,i.__)("No revisions found for this post.","dgwltd-revision-manager")))},g=()=>{const[e,t]=(0,r.useState)(!1),[a,o]=(0,r.useState)(null),[m,g]=(0,r.useState)("open"),[v,w]=(0,r.useState)(null),u=(0,l.useSelect)(e=>e("core/editor").getCurrentPostId(),[]);(0,l.useSelect)(e=>e("core/editor").getCurrentPostType(),[]),(0,r.useEffect)(()=>{u&&_()},[u]);const _=async()=>{t(!0),w(null);try{const e=await d()({path:`/dgw-revision-manager/v1/revisions/${u}`});o(e),g(e.revision_mode||"open")}catch(e){w((0,i.__)("Failed to load revision data.","dgwltd-revision-manager")),console.error("Error loading revision data:",e)}finally{t(!1)}};return u?(0,n.createElement)("div",{className:"dgw-revision-manager-panel"},v&&(0,n.createElement)(s.Notice,{status:"error",isDismissible:!0,onRemove:()=>w(null)},v),(0,n.createElement)(s.PanelBody,{title:(0,i.__)("Revision Manager","dgwltd-revision-manager"),initialOpen:!0},(0,n.createElement)(s.RadioControl,{label:(0,i.__)("Revision Mode","dgwltd-revision-manager"),selected:m,onChange:async e=>{t(!0),w(null);try{await d()({path:`/dgw-revision-manager/v1/revisions/${u}/mode`,method:"PUT",data:{mode:e}}),g(e),await _()}catch(e){w((0,i.__)("Failed to update revision mode.","dgwltd-revision-manager")),console.error("Error updating revision mode:",e)}finally{t(!1)}},disabled:e,options:[{label:(0,i.__)("Standard WordPress Revisions","dgwltd-revision-manager"),value:"open"},{label:(0,i.__)("Requires Approval","dgwltd-revision-manager"),value:"pending"}],help:(0,i.__)("Choose how revisions are managed for this post.","dgwltd-revision-manager")}),"open"===m&&(0,n.createElement)("p",{className:"description"},(0,i.__)("All changes are saved automatically as revisions using standard WordPress behavior.","dgwltd-revision-manager")),e&&(0,n.createElement)(s.Spinner,null)),"pending"===m&&(0,n.createElement)(s.PanelBody,{title:(0,i.__)("Revision Timeline","dgwltd-revision-manager"),initialOpen:!0},e?(0,n.createElement)("div",{className:"dgw-loading-container"},(0,n.createElement)(s.Spinner,null),(0,n.createElement)("p",null,(0,i.__)("Loading timeline...","dgwltd-revision-manager"))):a?(0,n.createElement)(c,{revisionData:a,onRevisionChange:()=>{_()}}):(0,n.createElement)("p",null,(0,i.__)("No revision data available.","dgwltd-revision-manager")),(0,n.createElement)("div",{className:"dgw-panel-actions"},(0,n.createElement)(s.Button,{isSecondary:!0,onClick:_,disabled:e},(0,i.__)("Refresh","dgwltd-revision-manager"))))):(0,n.createElement)(s.PanelBody,{title:(0,i.__)("Revision Manager","dgwltd-revision-manager")},(0,n.createElement)("p",null,(0,i.__)("Save the post to enable revision management.","dgwltd-revision-manager")))};(0,t.registerPlugin)("dgw-revision-manager",{render:()=>(0,n.createElement)(r.Fragment,null,(0,n.createElement)(a.PluginSidebarMoreMenuItem,{target:"dgw-revision-manager",icon:"backup"},(0,i.__)("Revision Manager","dgwltd-revision-manager")),(0,n.createElement)(a.PluginSidebar,{name:"dgw-revision-manager",title:(0,i.__)("Revision Manager","dgwltd-revision-manager"),icon:"backup"},(0,n.createElement)(g,null))),icon:"backup"})})();