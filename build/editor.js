(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var a in n)e.o(n,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:n[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.React,n=window.wp.plugins,a=window.wp.editPost,i=window.wp.i18n,r=window.wp.element,l=window.wp.data,s=window.wp.components,o=window.wp.apiFetch;var d=e.n(o);const m=({revision:e,isFirst:n,isLast:a,onSetCurrent:r,disabled:l})=>{const{id:o,title:d,author:m,date:c,status:g,is_current:v,excerpt:u}=e,w=e=>{switch(e){case"current":return(0,i.__)("Current","dgwltd-revision-manager");case"pending":return(0,i.__)("Pending","dgwltd-revision-manager");case"past":return(0,i.__)("Past","dgwltd-revision-manager");default:return(0,i.__)("Unknown","dgwltd-revision-manager")}};return(0,t.createElement)("div",{className:`dgw-timeline-item dgw-timeline-item--${g} ${v?"dgw-timeline-item--current":""}`},(0,t.createElement)("div",{className:"dgw-timeline-marker"},(0,t.createElement)("span",{className:"dgw-timeline-icon",role:"img","aria-label":w(g)},(e=>{switch(e){case"current":return"●";case"pending":return"◒";default:return"○"}})(g))),(0,t.createElement)("div",{className:"dgw-timeline-content"},(0,t.createElement)("div",{className:"dgw-timeline-header"},(0,t.createElement)("h4",{className:"dgw-timeline-title"},d||(0,i.__)("(No title)","dgwltd-revision-manager")),(0,t.createElement)("span",{className:`dgw-timeline-status dgw-timeline-status--${g}`},w(g))),(0,t.createElement)("div",{className:"dgw-timeline-meta"},(0,t.createElement)("span",{className:"dgw-timeline-author"},(0,i.__)("By","dgwltd-revision-manager")," ",m),(0,t.createElement)("span",{className:"dgw-timeline-date"},new Date(c).toLocaleDateString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}))),u&&(0,t.createElement)("p",{className:"dgw-timeline-excerpt"},u),(0,t.createElement)("div",{className:"dgw-timeline-actions"},!v&&(0,t.createElement)(s.Button,{isSmall:!0,isSecondary:!0,onClick:r,disabled:l},(0,i.__)("Set as Current","dgwltd-revision-manager")),(0,t.createElement)(s.Button,{isSmall:!0,isTertiary:!0,href:`/wp-admin/revision.php?revision=${o}`,target:"_blank"},(0,i.__)("View","dgwltd-revision-manager")))))},c=({revisionData:e,onRevisionChange:n})=>{const[a,l]=(0,r.useState)(!1),[o,c]=(0,r.useState)(null),[g,v]=(0,r.useState)(null),{timeline:u,current_revision_id:w,total_revisions:_}=e,p=()=>{v(null)};return u&&0!==u.length?(0,t.createElement)("div",{className:"dgw-revision-timeline"},o&&(0,t.createElement)(s.Notice,{status:"error",isDismissible:!0,onRemove:()=>c(null)},o),(0,t.createElement)("div",{className:"dgw-timeline-header"},(0,t.createElement)("p",{className:"dgw-timeline-meta"},_," ",1===_?(0,i.__)("revision","dgwltd-revision-manager"):(0,i.__)("revisions","dgwltd-revision-manager"))),(0,t.createElement)("div",{className:"dgw-timeline-container"},(0,t.createElement)("div",{className:"dgw-timeline-line"}),u.map((e,n)=>(0,t.createElement)(m,{key:e.id,revision:e,isFirst:0===n,isLast:n===u.length-1,onSetCurrent:()=>(e=>{v(e)})(e),disabled:a}))),g&&(0,t.createElement)(s.Modal,{title:(0,i.__)("Set Revision as Current","dgwltd-revision-manager"),onRequestClose:p,className:"dgw-confirm-modal"},(0,t.createElement)("p",null,(0,i.__)("Are you sure you want to set this revision as the current version?","dgwltd-revision-manager")),(0,t.createElement)("div",{className:"dgw-modal-revision-preview"},(0,t.createElement)("h4",null,g.title||(0,i.__)("(No title)","dgwltd-revision-manager")),(0,t.createElement)("p",{className:"dgw-revision-meta"},(0,i.__)("By","dgwltd-revision-manager")," ",g.author," • ",new Date(g.date).toLocaleDateString()),g.excerpt&&(0,t.createElement)("p",{className:"dgw-revision-excerpt"},g.excerpt)),(0,t.createElement)("div",{className:"dgw-modal-actions"},(0,t.createElement)(s.Button,{isSecondary:!0,onClick:p,disabled:a},(0,i.__)("Cancel","dgwltd-revision-manager")),(0,t.createElement)(s.Button,{isPrimary:!0,onClick:()=>(async e=>{l(!0),c(null);try{(await d()({path:`/dgw-revision-manager/v1/revisions/${e}/set-current`,method:"POST"})).success?(n(),v(null)):c((0,i.__)("Failed to set revision as current.","dgwltd-revision-manager"))}catch(e){c((0,i.__)("Error setting revision as current.","dgwltd-revision-manager")),console.error("Error setting current revision:",e)}finally{l(!1)}})(g.id),disabled:a},a?(0,t.createElement)(s.Spinner,null):(0,i.__)("Set as Current","dgwltd-revision-manager"))))):(0,t.createElement)("div",{className:"dgw-timeline-empty"},(0,t.createElement)("p",null,(0,i.__)("No revisions found for this post.","dgwltd-revision-manager")))},g=()=>{const[e,n]=(0,r.useState)(!1),[a,o]=(0,r.useState)(null),[m,g]=(0,r.useState)("open"),[v,u]=(0,r.useState)(null),w=(0,l.useSelect)(e=>e("core/editor").getCurrentPostId(),[]);(0,l.useSelect)(e=>e("core/editor").getCurrentPostType(),[]),(0,r.useEffect)(()=>{w&&_()},[w]);const _=async()=>{n(!0),u(null);try{const e=await d()({path:`/dgw-revision-manager/v1/revisions/${w}`});o(e),g(e.post_status||"open")}catch(e){u((0,i.__)("Failed to load revision data.","dgwltd-revision-manager")),console.error("Error loading revision data:",e)}finally{n(!1)}};return w?(0,t.createElement)("div",{className:"dgw-revision-manager-panel"},v&&(0,t.createElement)(s.Notice,{status:"error",isDismissible:!0,onRemove:()=>u(null)},v),(0,t.createElement)(s.PanelBody,{title:(0,i.__)("Post Settings","dgwltd-revision-manager"),initialOpen:!0},(0,t.createElement)(s.SelectControl,{label:(0,i.__)("Revision Status","dgwltd-revision-manager"),value:m,onChange:async e=>{n(!0),u(null);try{await d()({path:`/dgw-revision-manager/v1/revisions/${w}/status`,method:"PUT",data:{status:e}}),g(e),await _()}catch(e){u((0,i.__)("Failed to update status.","dgwltd-revision-manager")),console.error("Error updating status:",e)}finally{n(!1)}},disabled:e,options:[{label:(0,i.__)("Open","dgwltd-revision-manager"),value:"open"},{label:(0,i.__)("Pending","dgwltd-revision-manager"),value:"pending"},{label:(0,i.__)("Locked","dgwltd-revision-manager"),value:"locked"}],help:(0,i.__)("Control how revisions are handled for this post.","dgwltd-revision-manager")}),(0,t.createElement)("div",{className:"dgw-status-indicator"},(0,t.createElement)("span",{className:`status-badge status-${m}`},"open"===m&&(0,i.__)("Open","dgwltd-revision-manager"),"pending"===m&&(0,i.__)("Pending","dgwltd-revision-manager"),"locked"===m&&(0,i.__)("Locked","dgwltd-revision-manager"))),e&&(0,t.createElement)(s.Spinner,null)),(0,t.createElement)(s.PanelBody,{title:(0,i.__)("Revision Timeline","dgwltd-revision-manager"),initialOpen:!0},e?(0,t.createElement)("div",{className:"dgw-loading-container"},(0,t.createElement)(s.Spinner,null),(0,t.createElement)("p",null,(0,i.__)("Loading timeline...","dgwltd-revision-manager"))):a?(0,t.createElement)(c,{revisionData:a,onRevisionChange:()=>{_()}}):(0,t.createElement)("p",null,(0,i.__)("No revision data available.","dgwltd-revision-manager")),(0,t.createElement)("div",{className:"dgw-panel-actions"},(0,t.createElement)(s.Button,{isSecondary:!0,onClick:_,disabled:e},(0,i.__)("Refresh","dgwltd-revision-manager"))))):(0,t.createElement)(s.PanelBody,{title:(0,i.__)("Revision Manager","dgwltd-revision-manager")},(0,t.createElement)("p",null,(0,i.__)("Save the post to enable revision management.","dgwltd-revision-manager")))};(0,n.registerPlugin)("dgw-revision-manager",{render:()=>(0,t.createElement)(r.Fragment,null,(0,t.createElement)(a.PluginSidebarMoreMenuItem,{target:"dgw-revision-manager",icon:"backup"},(0,i.__)("Revision Manager","dgwltd-revision-manager")),(0,t.createElement)(a.PluginSidebar,{name:"dgw-revision-manager",title:(0,i.__)("Revision Manager","dgwltd-revision-manager"),icon:"backup"},(0,t.createElement)(g,null))),icon:"backup"})})();