(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var i in n)e.o(n,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:n[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.React,n=window.wp.element,i=window.wp.i18n,r=window.wp.components,s=window.wp.apiFetch;var l=e.n(s);const a=()=>{const[e,s]=(0,n.useState)(!1),[a,c]=(0,n.useState)(null),[d,m]=(0,n.useState)(!1),[u,g]=(0,n.useState)(null),{revisionId:v,postId:w,canManageRevisions:E}=dgwRevisionEditor;(0,n.useEffect)(()=>{w&&p()},[w]);const p=async()=>{s(!0);try{const e=await l()({path:`/dgw-revision-manager/v1/revisions/${w}?limit=20`});c(e)}catch(e){console.error("Error loading revision data:",e)}finally{s(!1)}},h=a?.timeline?a.timeline.find(e=>e.id===parseInt(v)):null,_=(()=>{if(!a?.timeline)return null;const e=a.timeline.findIndex(e=>e.id===parseInt(v));return-1===e?null:{before:a.timeline.slice(0,e),after:a.timeline.slice(e+1),current:a.timeline[e]}})(),y=h?.is_current;return(0,t.createElement)("div",{className:"dgw-revision-editor-enhancements"},u&&(0,t.createElement)(r.Notice,{status:u.type,isDismissible:!0,onRemove:()=>g(null)},u.message),(0,t.createElement)("div",{className:"dgw-revision-actions"},(0,t.createElement)("h3",null,dgwRevisionEditor.strings.revisionTimeline),e?(0,t.createElement)("div",{className:"dgw-loading"},(0,t.createElement)(r.Spinner,null),(0,t.createElement)("span",null,(0,i.__)("Loading...","dgwltd-revision-manager"))):(0,t.createElement)(t.Fragment,null,E&&!y&&(0,t.createElement)(r.Button,{isPrimary:!0,onClick:()=>m(!0),disabled:e},dgwRevisionEditor.strings.setAsCurrent),y&&(0,t.createElement)("div",{className:"dgw-current-indicator"},(0,t.createElement)("strong",null,(0,i.__)("This is the current revision","dgwltd-revision-manager"))),_&&(0,t.createElement)(o,{context:_}))),d&&(0,t.createElement)(r.Modal,{title:dgwRevisionEditor.strings.setAsCurrent,onRequestClose:()=>m(!1)},(0,t.createElement)("p",null,dgwRevisionEditor.strings.confirmSetCurrent),(0,t.createElement)("div",{className:"dgw-modal-actions"},(0,t.createElement)(r.Button,{isSecondary:!0,onClick:()=>m(!1),disabled:e},(0,i.__)("Cancel","dgwltd-revision-manager")),(0,t.createElement)(r.Button,{isPrimary:!0,onClick:async()=>{s(!0),g(null);try{(await l()({path:`/dgw-revision-manager/v1/revisions/${v}/set-current`,method:"POST"})).success?(g({type:"success",message:dgwRevisionEditor.strings.success}),await p()):g({type:"error",message:dgwRevisionEditor.strings.error})}catch(e){g({type:"error",message:dgwRevisionEditor.strings.error}),console.error("Error setting current revision:",e)}finally{s(!1),m(!1)}},disabled:e},e?(0,t.createElement)(r.Spinner,null):dgwRevisionEditor.strings.setAsCurrent))))},o=({context:e})=>{const{before:n,after:r,current:s}=e;return(0,t.createElement)("div",{className:"dgw-timeline-context"},(0,t.createElement)("h4",null,(0,i.__)("Timeline Context","dgwltd-revision-manager")),(0,t.createElement)("div",{className:"dgw-context-timeline"},n.length>0&&(0,t.createElement)("div",{className:"dgw-context-section"},(0,t.createElement)("h5",null,(0,i.__)("Newer Revisions","dgwltd-revision-manager")," (",n.length,")"),(0,t.createElement)("ul",null,n.slice(0,3).map(e=>(0,t.createElement)("li",{key:e.id},(0,t.createElement)("a",{href:`/wp-admin/revision.php?revision=${e.id}`},e.title||(0,i.__)("(No title)","dgwltd-revision-manager")),(0,t.createElement)("span",{className:`status-${e.status}`},e.status))),n.length>3&&(0,t.createElement)("li",null,(0,t.createElement)("em",null,(0,i.__)("and %d more...","dgwltd-revision-manager").replace("%d",n.length-3))))),(0,t.createElement)("div",{className:"dgw-context-current"},(0,t.createElement)("h5",null,(0,i.__)("Current Viewing","dgwltd-revision-manager")),(0,t.createElement)("div",{className:"dgw-current-revision"},(0,t.createElement)("strong",null,s.title||(0,i.__)("(No title)","dgwltd-revision-manager")),(0,t.createElement)("span",{className:`status-${s.status} ${s.is_current?"is-current":""}`},s.status,s.is_current&&" (Active)"))),r.length>0&&(0,t.createElement)("div",{className:"dgw-context-section"},(0,t.createElement)("h5",null,(0,i.__)("Older Revisions","dgwltd-revision-manager")," (",r.length,")"),(0,t.createElement)("ul",null,r.slice(0,3).map(e=>(0,t.createElement)("li",{key:e.id},(0,t.createElement)("a",{href:`/wp-admin/revision.php?revision=${e.id}`},e.title||(0,i.__)("(No title)","dgwltd-revision-manager")),(0,t.createElement)("span",{className:`status-${e.status}`},e.status))),r.length>3&&(0,t.createElement)("li",null,(0,t.createElement)("em",null,(0,i.__)("and %d more...","dgwltd-revision-manager").replace("%d",r.length-3)))))))};document.addEventListener("DOMContentLoaded",()=>{const e=document.createElement("div");e.id="dgw-revision-editor-enhancements";const i=document.querySelector(".revisions-meta")||document.querySelector("#revision-diff");i?i.parentNode.insertBefore(e,i.nextSibling):document.body.appendChild(e),(0,n.render)((0,t.createElement)(a,null),e)})})();